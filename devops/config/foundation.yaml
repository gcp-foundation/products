organizations:
- displayName: ${domain}

  folders:

  - displayName : ${folder_devops}

    projects:

    - displayName: ${project_control}
      labels: ${project_labels}
      services: 
      - compute.googleapis.com              # - Enabled by google by default
      - oslogin.googleapis.com              # - Enabled by google by default
      - cloudkms.googleapis.com             # - For CMEK keys
      - storage.googleapis.com              # - For storage buckets (terraform state)
      - cloudresourcemanager.googleapis.com # - Required for running terraform
      - serviceusage.googleapis.com         # - Required for running terraform 
      - iam.googleapis.com                  # - Required for running terraform
      - cloudbuild.googleapis.com           # - Required for running terraform
      - cloudasset.googleapis.com           # - Required for running terraform
      - orgpolicy.googleapis.com            # - Required for running terraform
      - pubsub.googleapis.com               # - Required for running terraform
      - bigquery.googleapis.com             # - Required for running terraform
      - bigquerymigration.googleapis.com    # - Enabled by google as dependency
      - bigquerystorage.googleapis.com      # - Enabled by google as dependency
      serviceAccounts:
      - name: ${sa_devops}
        displayName: Pipeline ${folder_devops} 
        description: Cloudbuild Service Account for ${folder_devops} folder
      - name: ${sa_management}
        displayName: Pipeline ${folder_management}
        description: Cloudbuild Service Account for ${folder_management} folder
      # Implemented as terraform at the momemnt
      keyRings:
      - name: ${project_control}
        location: europe-west2
        cryptoKeys:
        - name: ${project_control}
          primary:
            protectionLevel: HSM
            algorithm: GOOGLE_SYMMETRIC_ENCRYPTION
          purpose: ENCRYPT_DECRYPT
          destroyScheduledDuration: 86400s
      # Implemented as terraform at the momemnt
      storage:
      - name: ${bucket_tfstate}

    - displayName: ${project_pipelines}
      labels: ${project_labels}
      services:       
      - compute.googleapis.com              # - Enabled by google by default
      - oslogin.googleapis.com              # - Enabled by google by default
      - serviceusage.googleapis.com         # - For enabling services 
      - cloudkms.googleapis.com             # - For CMEK keys
      - storage.googleapis.com              # - For storage buckets (cloudbuild outputs)
      - artifactregistry.googleapis.com     # - For docker images
      - sourcerepo.googleapis.com           # - For cloud source repositories
      - cloudbuild.googleapis.com           # - For cloud build triggers
      - logging.googleapis.com              # - Enabled by google - dependency on cloudbuild
      - pubsub.googleapis.com               # - Enabled by google - dependency on source repos
      - storage-api.googleapis.com          # - Enabled by google - dependency on cloudbuild?
      - iam.googleapis.com                  # - Required for pipelines?
      serviceAccounts:
      - name: ${sa_guardrail_orgpolicy}
        displayName: Guardrail Organization Policy
        description: Cloudfunction Service Account for Organization Policy Guardrail
      # Implemented as terraform at the momemnt
      keyRings:
      - name: ${project_pipelines}
        location: europe-west2
        cryptoKeys:
        - name: ${project_pipelines}
          primary:
            protectionLevel: HSM
            algorithm: GOOGLE_SYMMETRIC_ENCRYPTION
          purpose: ENCRYPT_DECRYPT
          destroyScheduledDuration: 86400s

  - displayName: ${folder_management}
  
    projects:

    - displayName: ${project_logging}
      labels: ${project_labels}
      services: 
      - compute.googleapis.com              # - Enabled by google by default
      - oslogin.googleapis.com              # - Enabled by google by default
      - cloudkms.googleapis.com             # - For CMEK keys
      - bigquery.googleapis.com             # - For logging to bigquery
      - bigquerymigration.googleapis.com    # - Enabled by google as dependency
      - bigquerystorage.googleapis.com      # - Enabled by google as dependency
      # Implemented as terraform at the momemnt
      keyRings:
      - name: ${project_logging}
        location: europe-west2
        cryptoKeys:
        - name: ${project_logging}
          primary:
            protectionLevel: HSM
            algorithm: GOOGLE_SYMMETRIC_ENCRYPTION
          purpose: ENCRYPT_DECRYPT
          destroyScheduledDuration: 86400s

    - displayName: ${project_billing}
      labels: ${project_labels}
      services: 
      - compute.googleapis.com              # - Enabled by google by default
      - oslogin.googleapis.com              # - Enabled by google by default
      - bigquery.googleapis.com             # - For billing to bigquery

    - displayName: ${project_guardrails}
      labels: ${project_labels}
      services: 
      - compute.googleapis.com              # - Enabled by google by default
      - oslogin.googleapis.com              # - Enabled by google by default
      - cloudkms.googleapis.com             # - For CMEK keys
      - storage.googleapis.com              # - For cloud functions
      - artifactregistry.googleapis.com     # - For cloud functions
      - pubsub.googleapis.com               # - For cloud functions
      - cloudbuild.googleapis.com           # - For cloud functions
      - cloudfunctions.googleapis.com       # - For guardrails
      # Implemented as terraform at the momemnt
      keyRings:
      - name: guardrails
        location: europe-west2
        cryptoKeys:
        - name: guardrails
          primary:
            protectionLevel: HSM
            algorithm: GOOGLE_SYMMETRIC_ENCRYPTION
          purpose: ENCRYPT_DECRYPT
          destroyScheduledDuration: 86400s
